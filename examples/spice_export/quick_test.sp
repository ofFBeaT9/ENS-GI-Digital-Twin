* ENS-GI Digital Twin — SPICE Netlist
* Profile: healthy
* Segments: 5
* Generated by ENSGIDigitalTwin
*
* USAGE:
*   ngspice: ngspice netlist.sp
*   HSPICE:  hspice -i netlist.sp
*   Spectre: spectre netlist.sp

* --- Global Parameters ---
.param C_m = 1.0e-12
.param g_Na = 120.0e-3
.param g_K = 36.0e-3
.param g_Ca = 4.0e-3
.param g_L = 0.3e-3
.param g_gap = 0.3e-3
.param E_Na = 50.0e-3
.param E_K = -77.0e-3
.param E_Ca = 120.0e-3
.param E_L = -54.4e-3

* ═══════════════════════════════════════════════════
* SUBCIRCUIT DEFINITIONS (Behavioral Models)
* ═══════════════════════════════════════════════════

* Sodium channel (simplified - voltage-controlled current source)
.subckt na_channel vp vn
  G_na vp vn VALUE={(g_Na * pow((1/(1+exp(-(v(vp,vn)*1000+40)/10))), 3) * 0.6) * (v(vp,vn) - E_Na)}
.ends

* Potassium channel (simplified - voltage-controlled current source)
.subckt k_channel vp vn
  G_k vp vn VALUE={(g_K * pow((1/(1+exp(-(v(vp,vn)*1000+55)/10))), 4)) * (v(vp,vn) - E_K)}
.ends

* Calcium channel (L-type - voltage-controlled current source)
.subckt ca_channel vp vn
  .param g_Ca_local=2.0e-3 E_Ca_local=120e-3
  .param V_half=-20.0 k=9.0
  G_ca vp vn VALUE={(g_Ca_local * (1/(1+exp(-(v(vp,vn)*1000+V_half)/k)))) * (v(vp,vn) - E_Ca_local)}
.ends

* Leak channel (simple resistor)
.subckt leak vp vn
  G_l vp vn VALUE={g_L * (v(vp,vn) - E_L)}
.ends

* KCa channel (Ca-activated K+ - simplified without Ca dynamics)
* Note: Full implementation requires Ca concentration tracking
.subckt kca_channel vp vn
  .param g_KCa_local=1.5e-3
  .param Ca_half=0.5e-6 K_Ca=0.3e-6
  * Simplified: assumes Ca ~ 0.5 μM (resting)
  G_kca vp vn VALUE={(g_KCa_local * 0.3) * (v(vp,vn) - E_K)}
.ends

* A-type K channel (transient outward K+ current)
.subckt a_type_k vp vn
  .param g_A_local=1.0e-3
  .param V_half_act=-30.0 k_act=15.0
  .param V_half_inact=-60.0 k_inact=8.0
  * Activation * Inactivation
  G_a vp vn VALUE={(g_A_local * (1/(1+exp(-(v(vp,vn)*1000+V_half_act)/k_act))) * (1/(1+exp((v(vp,vn)*1000+V_half_inact)/k_inact)))) * (v(vp,vn) - E_K)}
.ends

* ═══════════════════════════════════════════════════
* ENS NETWORK INSTANTIATION
* ═══════════════════════════════════════════════════

* --- Neuron 0 ---
C_m0 V0 0 {C_m}

X_na0 V0 0 na_channel
X_k0  V0 0 k_channel
X_ca0 V0 0 ca_channel
X_l0  V0 0 leak
I_icc0 V0 0 SIN(0 12.0u 0.049974652130855134 0 0 0.0)
R_gap0 V0 V1 {1/(g_gap+1n)}

* --- Neuron 1 ---
C_m1 V1 0 {C_m}

X_na1 V1 0 na_channel
X_k1  V1 0 k_channel
X_ca1 V1 0 ca_channel
X_l1  V1 0 leak
I_icc1 V1 0 SIN(0 12.0u 0.049974652130855134 0 0 0.3)
R_gap1 V1 V2 {1/(g_gap+1n)}

* --- Neuron 2 ---
C_m2 V2 0 {C_m}

X_na2 V2 0 na_channel
X_k2  V2 0 k_channel
X_ca2 V2 0 ca_channel
X_l2  V2 0 leak
I_icc2 V2 0 SIN(0 12.0u 0.049974652130855134 0 0 0.6)
R_gap2 V2 V3 {1/(g_gap+1n)}

* --- Neuron 3 ---
C_m3 V3 0 {C_m}

X_na3 V3 0 na_channel
X_k3  V3 0 k_channel
X_ca3 V3 0 ca_channel
X_l3  V3 0 leak
I_icc3 V3 0 SIN(0 12.0u 0.049974652130855134 0 0 0.8999999999999999)
R_gap3 V3 V4 {1/(g_gap+1n)}

* --- Neuron 4 ---
C_m4 V4 0 {C_m}

X_na4 V4 0 na_channel
X_k4  V4 0 k_channel
X_ca4 V4 0 ca_channel
X_l4  V4 0 leak
I_icc4 V4 0 SIN(0 12.0u 0.049974652130855134 0 0 1.2)

* --- Stimulus ---
I_stim V2 0 PULSE(0 10u 10m 1m 1m 50m 200m)

* ═══════════════════════════════════════════════════
* SIMULATION CONTROL
* ═══════════════════════════════════════════════════

* Transient analysis: 0.05ms steps, 1000ms duration
.tran 0.05m 1000m

* Output probes
.print tran v(V0) v(V1) v(V2)

* Convergence options
.options reltol=1e-4 abstol=1e-9 vntol=1e-6
.options method=gear

.end